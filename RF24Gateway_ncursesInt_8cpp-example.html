<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RF24Gateway - TCP/IP over RF24Network: RF24Gateway_ncursesInt.cpp</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RF24Gateway - TCP/IP over RF24Network<span id="projectnumber">&#160;v2.1.0</span>
   </div>
   <div id="projectbrief">TMRh20 - Pushing the practical limits of RF24 modules</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">RF24Gateway_ncursesInt.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>A copy of the ncurses example using interrupts.</p>
<div class="fragment"><div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * RF24Gateway NCurses interface - TMRh20 2015-2022</span></div>
<div class="line"><span class="comment"> * This is a generic tool for nodes supporting or combining with RF24Ethernet and/or RF24Network.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The tool provides a simple interface for monitoring information and activity regarding the RF24Gateway: &lt;br&gt;</span></div>
<div class="line"><span class="comment"> * a: Interface statistics from /proc/net/dev &lt;br&gt;</span></div>
<div class="line"><span class="comment"> * b: RF24Mesh address/id assignments &lt;br&gt;</span></div>
<div class="line"><span class="comment"> * c: RF24Network/Radio information &lt;br&gt;</span></div>
<div class="line"><span class="comment"> * d: Active IP connections (optional) &lt;br&gt;</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * **Requirements: NCurses**</span></div>
<div class="line"><span class="comment"> * Install NCurses: apt-get install libncurses5-dev</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * **Controls**</span></div>
<div class="line"><span class="comment"> * Type &#39;h&#39; to view the help menu</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;RF24/RF24.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;RF24Network/RF24Network.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;RF24Mesh/RF24Mesh.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;RF24Gateway/RF24Gateway.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/socket.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ifaddrs.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;netdb.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ncurses.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;linux/if.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;net/if_arp.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;linux/sockios.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/******************************************************************/</span></div>
<div class="line"><span class="comment">//User Configuration</span></div>
<div class="line">RF24 radio(22, 0);</div>
<div class="line">RF24Network network(radio);</div>
<div class="line">RF24Mesh mesh(radio, network);</div>
<div class="line"><a id="_a0" name="_a0"></a><a class="code hl_class" href="classESBGateway.html">RF24Gateway</a> gw(radio, network, mesh);</div>
<div class="line"> </div>
<div class="line">uint8_t nodeID = 0;</div>
<div class="line"><span class="keywordtype">int</span> interruptPin = 24;</div>
<div class="line"><span class="comment">/******************************************************************/</span></div>
<div class="line"> </div>
<div class="line">WINDOW* win;</div>
<div class="line">WINDOW* meshPad;</div>
<div class="line">WINDOW* connPad;</div>
<div class="line">WINDOW* devPad;</div>
<div class="line">WINDOW* rf24Pad;</div>
<div class="line">WINDOW* cfgPad;</div>
<div class="line">WINDOW* renewPad;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> drawMain(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keywordtype">void</span> drawHelp(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keywordtype">void</span> drawCfg(<span class="keywordtype">bool</span> isConf);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> drawDevPad(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keywordtype">void</span> drawMeshPad(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keywordtype">void</span> drawConnPad(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keywordtype">void</span> drawRF24Pad(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keywordtype">void</span> drawTopology();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> maxX, maxY;</div>
<div class="line"><span class="keywordtype">int</span> padSelection = 0;</div>
<div class="line"><span class="keywordtype">int</span> meshScroll = 0;</div>
<div class="line"><span class="keywordtype">int</span> connScroll = 0;</div>
<div class="line"><span class="keywordtype">int</span> rf24Scroll = 0;</div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> updateRate = 1000;</div>
<div class="line"> </div>
<div class="line">uint32_t meshInfoTimer = 0;</div>
<div class="line">uint32_t fifoTimer;</div>
<div class="line">uint32_t fifoClears;</div>
<div class="line">uint32_t mesh_timer = 0;</div>
<div class="line"><span class="keywordtype">size_t</span> networkPacketsRX = 0;</div>
<div class="line">std::string subIP;</div>
<div class="line">std::string tunStr(<span class="stringliteral">&quot;tun_nrf24&quot;</span>);</div>
<div class="line"><span class="keywordtype">bool</span> showConnPad;</div>
<div class="line"><span class="keywordtype">bool</span> topo = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">size_t</span> bRX;</div>
<div class="line"><span class="keywordtype">size_t</span> bTX;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/******************************************************************/</span></div>
<div class="line"><span class="comment">/***********************MAIN***************************************/</span></div>
<div class="line"><span class="keywordtype">void</span> intHandler()</div>
<div class="line">{</div>
<div class="line">    gw.update(<span class="keyword">true</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    gw.begin(nodeID);</div>
<div class="line">    <span class="comment">//mesh.setStaticAddress(8,1);</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//uint8_t nodeID = 22;</span></div>
<div class="line">    <span class="comment">//gw.begin(nodeID,3,RF24_2MBPS);</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//uint16_t address = 0;</span></div>
<div class="line">    <span class="comment">//gw.begin(address,3,RF24_2MBPS);</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /** Setup NCurses**/</span></div>
<div class="line"><span class="comment">    /*******************************/</span></div>
<div class="line">    win = initscr();</div>
<div class="line">    cbreak();</div>
<div class="line">    noecho();</div>
<div class="line">    getmaxyx(win, maxX, maxY);</div>
<div class="line"> </div>
<div class="line">    keypad(win, TRUE);</div>
<div class="line">    start_color();</div>
<div class="line">    curs_set(0);</div>
<div class="line">    init_pair(1, COLOR_GREEN, COLOR_BLACK);</div>
<div class="line">    init_pair(2, COLOR_MAGENTA, COLOR_BLACK);</div>
<div class="line">    init_pair(3, COLOR_YELLOW, COLOR_BLACK);</div>
<div class="line">    init_pair(4, COLOR_CYAN, COLOR_BLACK);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /** Setup Pads**/</span></div>
<div class="line"><span class="comment">    /*******************************/</span></div>
<div class="line">    devPad = newpad(11, 40);</div>
<div class="line">    meshPad = newpad(50, 50);</div>
<div class="line">    rf24Pad = newpad(11, 40);</div>
<div class="line">    connPad = newpad(21, 150);</div>
<div class="line">    cfgPad = newpad(10, 40);</div>
<div class="line">    renewPad = newpad(1, 35);</div>
<div class="line"> </div>
<div class="line">    scrollok(meshPad, <span class="keyword">true</span>);</div>
<div class="line">    scrollok(connPad, <span class="keyword">true</span>);</div>
<div class="line">    scrollok(rf24Pad, <span class="keyword">true</span>);</div>
<div class="line">    timeout(0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//MANUAL IP</span></div>
<div class="line">    <span class="comment">//char ip[] = &quot;10.10.3.1&quot;;</span></div>
<div class="line">    <span class="comment">//char subnet[] = &quot;255.255.255.0&quot;;</span></div>
<div class="line">    <span class="comment">//gw.setIP(ip,subnet);</span></div>
<div class="line"> </div>
<div class="line">    drawMain();</div>
<div class="line"> </div>
<div class="line">    radio.maskIRQ(1, 1, 0);</div>
<div class="line">    attachInterrupt(interruptPin, INT_EDGE_FALLING, intHandler);</div>
<div class="line"> </div>
<div class="line"><span class="comment">    /******************************************************************/</span></div>
<div class="line"><span class="comment">    /***********************LOOP***************************************/</span></div>
<div class="line">    <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;</div>
<div class="line">    uint32_t failCounter = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1)</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (millis() - mesh_timer &gt; 30000 &amp;&amp; mesh.getNodeID() &gt; 0)</div>
<div class="line">        { <span class="comment">//Every 30 seconds, test mesh connectivity</span></div>
<div class="line">            <span class="keywordflow">if</span> (!mesh.checkConnection())</div>
<div class="line">            {</div>
<div class="line">                wclear(renewPad);</div>
<div class="line">                mvwprintw(renewPad, 0, 0, <span class="stringliteral">&quot;*Renewing Address*&quot;</span>);</div>
<div class="line">                prefresh(renewPad, 0, 0, 3, 26, 4, 55);</div>
<div class="line">                <span class="keywordflow">if</span> ((ok = mesh.renewAddress()))</div>
<div class="line">                {</div>
<div class="line">                    wclear(renewPad);</div>
<div class="line">                    prefresh(renewPad, 0, 0, 3, 26, 4, 55);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            mesh_timer = millis();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ok)</div>
<div class="line">        { <span class="comment">//Non-master nodes need an active connection to the mesh in order to handle data</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">            /** Read RF24Network Payloads (Do nothing with them currently) **/</span></div>
<div class="line"><span class="comment">            /*******************************/</span></div>
<div class="line">            <span class="keywordflow">if</span> (network.available())</div>
<div class="line">            {</div>
<div class="line">                ++networkPacketsRX;</div>
<div class="line">                RF24NetworkHeader header;</div>
<div class="line"> </div>
<div class="line">                <span class="comment">// un-needed variables</span></div>
<div class="line">                <span class="comment">// size_t size = network.peek(header);</span></div>
<div class="line">                <span class="comment">// uint8_t buf[size];</span></div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (header.type == 1) <span class="comment">// header.type is uninitialized</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="keyword">struct </span>timeStruct</div>
<div class="line">                    {</div>
<div class="line">                        uint8_t hr;</div>
<div class="line">                        uint8_t min;</div>
<div class="line">                    } myTime;</div>
<div class="line"> </div>
<div class="line">                    time_t mTime;</div>
<div class="line">                    time(&amp;mTime);</div>
<div class="line">                    <span class="keyword">struct </span>tm* tm = localtime(&amp;mTime);</div>
<div class="line"> </div>
<div class="line">                    myTime.hr = tm-&gt;tm_hour;</div>
<div class="line">                    myTime.min = tm-&gt;tm_min;</div>
<div class="line">                    RF24NetworkHeader hdr(header.from_node, 1);</div>
<div class="line">                    network.write(hdr, &amp;myTime, <span class="keyword">sizeof</span>(myTime));</div>
<div class="line">                }</div>
<div class="line">                network.read(header, 0, 0);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            delay(100); <span class="comment">//Big delay if connection to RF24Mesh is failing</span></div>
<div class="line">        }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">        /**</span></div>
<div class="line"><span class="comment">         * The gateway handles all IP traffic (marked as EXTERNAL_DATA_TYPE) and passes it to the associated network interface</span></div>
<div class="line"><span class="comment">         * RF24Network user payloads are loaded into the user cache</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        gw.poll(2);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">        /** Mesh address/id printout **/</span></div>
<div class="line"><span class="comment">        /*******************************/</span></div>
<div class="line">        <span class="keywordflow">if</span> (millis() - meshInfoTimer &gt; updateRate)</div>
<div class="line">        {</div>
<div class="line"> </div>
<div class="line">            getmaxyx(win, maxX, maxY);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Draw the pads on screen</span></div>
<div class="line">            drawDevPad();</div>
<div class="line">            prefresh(devPad, 0, 0, 4, 1, 14, 25);</div>
<div class="line"> </div>
<div class="line">            drawMeshPad();</div>
<div class="line">            wscrl(meshPad, meshScroll);</div>
<div class="line">            prefresh(meshPad, 0, 0, 4, 26, 14, 48);</div>
<div class="line"> </div>
<div class="line">            drawRF24Pad();</div>
<div class="line">            prefresh(rf24Pad, 0, 0, 4, 52, 14, 78);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (showConnPad)</div>
<div class="line">            {</div>
<div class="line">                drawConnPad();</div>
<div class="line">                wscrl(connPad, connScroll);</div>
<div class="line">                prefresh(connPad, 0, 0, 16, 1, maxX - 1, maxY - 2);</div>
<div class="line">            }</div>
<div class="line">        } <span class="comment">//MeshInfo Timer</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">        /** Handle keyboard input **/</span></div>
<div class="line"><span class="comment">        /*******************************/</span></div>
<div class="line">        <span class="keywordtype">int</span> myChar = getch();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (myChar &gt; -1)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//cout &lt;&lt; myChar &lt;&lt; endl;</span></div>
<div class="line">            <span class="keywordflow">switch</span> (myChar)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// a: En/Disable display of active connections</span></div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:</div>
<div class="line">                    <span class="keywordflow">if</span> (topo) {</div>
<div class="line">                        showConnPad = <span class="keyword">true</span>;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> {</div>
<div class="line">                        showConnPad = !showConnPad;</div>
<div class="line">                    }</div>
<div class="line">                    topo = <span class="keyword">false</span>;</div>
<div class="line">                    <span class="keywordflow">if</span> (!showConnPad)</div>
<div class="line">                    {</div>
<div class="line">                        wclear(connPad);</div>
<div class="line">                        prefresh(connPad, 0, 0, 15, 1, maxX - 1, maxY - 2);</div>
<div class="line">                        drawMain();</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="comment">// w: Increase frame-rate of curses display</span></div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>:</div>
<div class="line">                    <span class="keywordflow">if</span> (updateRate &gt; 100)</div>
<div class="line">                    {</div>
<div class="line">                        updateRate -= 100;</div>
<div class="line">                    }</div>
<div class="line">                    mvwprintw(win, 2, 27, <span class="stringliteral">&quot;Refresh Rate: %.1f fps&quot;</span>, 1000.0 / updateRate);</div>
<div class="line">                    refresh();</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="comment">// s: Decrease frame-rate of curses display</span></div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">                    updateRate += 100;</div>
<div class="line">                    mvwprintw(win, 2, 27, <span class="stringliteral">&quot;Refresh Rate: %.1f fps   \t&quot;</span>, 1000.0 / updateRate);</div>
<div class="line">                    refresh();</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="comment">// c: Display IP configuration menu</span></div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:</div>
<div class="line">                    drawCfg(1);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="comment">// h: Display help menu</span></div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line">                    drawHelp();</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div>
<div class="line">                    clear();</div>
<div class="line">                    endwin();</div>
<div class="line">                    <span class="keywordflow">return</span> 0;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> KEY_UP:</div>
<div class="line">                    <span class="keywordflow">if</span> (padSelection == 0)</div>
<div class="line">                    {</div>
<div class="line">                        meshScroll++;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (padSelection == 1)</div>
<div class="line">                    {</div>
<div class="line">                        connScroll++;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> KEY_DOWN:</div>
<div class="line">                    <span class="keywordflow">if</span> (padSelection == 0)</div>
<div class="line">                    {</div>
<div class="line">                        meshScroll--;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (padSelection == 1)</div>
<div class="line">                    {</div>
<div class="line">                        connScroll--;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> KEY_RIGHT:</div>
<div class="line">                    padSelection++;</div>
<div class="line">                    padSelection = std::min(padSelection, 1);</div>
<div class="line">                    <span class="keywordflow">break</span>; <span class="comment">//right</span></div>
<div class="line">                <span class="keywordflow">case</span> KEY_LEFT:</div>
<div class="line">                    padSelection--;</div>
<div class="line">                    padSelection = std::max(padSelection, 0);</div>
<div class="line">                    <span class="keywordflow">break</span>; <span class="comment">//left</span></div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;Q&#39;</span>:</div>
<div class="line">                    clear();</div>
<div class="line">                    endwin();</div>
<div class="line">                    <span class="keywordflow">return</span> 0;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                    meshScroll = std::max(meshScroll, 0);</div>
<div class="line">                    connScroll = std::max(connScroll, 0);</div>
<div class="line">                    meshInfoTimer = 0;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div>
<div class="line">                    topo = <span class="keyword">true</span>;</div>
<div class="line">                    showConnPad = <span class="keyword">true</span>;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//This section checks for failures detected by RF24 &amp; RF24Network as well as</span></div>
<div class="line">        <span class="comment">//checking for deviations from the default configuration (1MBPS data rate)</span></div>
<div class="line">        <span class="comment">//The mesh is restarted on failure and failure count logged to failLog.txt</span></div>
<div class="line">        <span class="comment">//This makes the radios hot-swappable, disconnect &amp; reconnect as desired, it should come up automatically</span></div>
<div class="line">        <span class="keywordflow">if</span> (radio.failureDetected &gt; 0 || radio.getDataRate() != RF24_1MBPS)</div>
<div class="line">        {</div>
<div class="line"> </div>
<div class="line">            std::ofstream myFile;</div>
<div class="line">            myFile.open(<span class="stringliteral">&quot;failLog.txt&quot;</span>);</div>
<div class="line">            <span class="keywordflow">if</span> (myFile.is_open())</div>
<div class="line">            {</div>
<div class="line">                myFile &lt;&lt; ++failCounter &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            myFile.close();</div>
<div class="line">            mesh.begin();</div>
<div class="line">            delay(1000);</div>
<div class="line">            radio.failureDetected = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    } <span class="comment">//while 1</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//delwin(meshPad);</span></div>
<div class="line">    <span class="comment">//delwin(connPad);</span></div>
<div class="line">    clear();</div>
<div class="line">    endwin();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">} <span class="comment">//main</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/******************************************************************/</span></div>
<div class="line"><span class="comment">/******************Main Drawing Functions**************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> drawTopology()</div>
<div class="line">{</div>
<div class="line">    wclear(connPad);</div>
<div class="line">    wattroff(connPad, COLOR_PAIR(1));</div>
<div class="line">    mvwhline(win, 15, 1, ACS_HLINE, maxY - 2);</div>
<div class="line">    mvwprintw(win, 15, 10, <span class="stringliteral">&quot;Mesh Topology&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    wattron(connPad, COLOR_PAIR(1));</div>
<div class="line">    <span class="keywordtype">int</span> connPadmaxX;</div>
<div class="line">    connPadmaxX = getmaxx(connPad);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 01; i &lt; 06; i++) {</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; mesh.addrListTop; j++) {</div>
<div class="line">            <span class="keywordflow">if</span> (mesh.addrList[j].address == i) {</div>
<div class="line">                wprintw(connPad, <span class="stringliteral">&quot;0%o[%d]   |    &quot;</span>, mesh.addrList[j].address, mesh.addrList[j].nodeID);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    wprintw(connPad, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    wattron(connPad, COLOR_PAIR(3));</div>
<div class="line">    uint16_t g = 051;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> h = 011; h &lt;= 015; h++) {</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = h; i &lt;= g; i += 010) {</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; mesh.addrListTop; j++) {</div>
<div class="line">                <span class="keywordflow">if</span> (mesh.addrList[j].address == i) {</div>
<div class="line">                    <span class="keywordtype">int</span> y = 0;</div>
<div class="line">                    <span class="keywordtype">int</span> x = 0;</div>
<div class="line">                    getyx(connPad, y, x);</div>
<div class="line">                    <span class="keywordflow">if</span> (x &gt; connPadmaxX - 77) {</div>
<div class="line">                        wprintw(connPad, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">                    }</div>
<div class="line">                    wprintw(connPad, <span class="stringliteral">&quot;0%o[%d] &quot;</span>, mesh.addrList[j].address, mesh.addrList[j].nodeID);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        g++;</div>
<div class="line">        wprintw(connPad, <span class="stringliteral">&quot;| &quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    wprintw(connPad, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    wattron(connPad, COLOR_PAIR(4));</div>
<div class="line">    g = 0411;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> h = 0111; h &lt;= 0145; h++) {</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = h; i &lt;= g; i += 0100) {</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; mesh.addrListTop; j++) {</div>
<div class="line">                <span class="keywordflow">if</span> (mesh.addrList[j].address == i) {</div>
<div class="line">                    <span class="keywordtype">int</span> y = 0;</div>
<div class="line">                    <span class="keywordtype">int</span> x = 0;</div>
<div class="line">                    getyx(connPad, y, x);</div>
<div class="line">                    <span class="keywordflow">if</span> (x &gt; connPadmaxX - 77) {</div>
<div class="line">                        wprintw(connPad, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">                    }</div>
<div class="line">                    wprintw(connPad, <span class="stringliteral">&quot;0%o[%d] &quot;</span>, mesh.addrList[j].address, mesh.addrList[j].nodeID);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        g++;</div>
<div class="line">    }</div>
<div class="line">    wprintw(connPad, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    wattron(connPad, COLOR_PAIR(2));</div>
<div class="line">    g = 04111;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> h = 01111; h &lt;= 01445; h++) {</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = h; i &lt;= g; i += 01000) {</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; mesh.addrListTop; j++) {</div>
<div class="line">                <span class="keywordflow">if</span> (mesh.addrList[j].address == i) {</div>
<div class="line">                    <span class="keywordtype">int</span> y = 0;</div>
<div class="line">                    <span class="keywordtype">int</span> x = 0;</div>
<div class="line">                    getyx(connPad, y, x);</div>
<div class="line">                    <span class="keywordflow">if</span> (x &gt; connPadmaxX - 77) {</div>
<div class="line">                        wprintw(connPad, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">                    }</div>
<div class="line">                    wprintw(connPad, <span class="stringliteral">&quot;0%o[%d] &quot;</span>, mesh.addrList[j].address, mesh.addrList[j].nodeID);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        g++;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> drawMain()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    clear();</div>
<div class="line"> </div>
<div class="line">    attron(COLOR_PAIR(1));</div>
<div class="line">    wprintw(win, <span class="stringliteral">&quot;RF24Gateway Ncurses Interface by TMRh20 - 2015-2022\n&quot;</span>);</div>
<div class="line">    whline(win, ACS_HLINE, maxY - 2);</div>
<div class="line">    attroff(COLOR_PAIR(1));</div>
<div class="line">    refresh();<span class="comment"></span></div>
<div class="line"><span class="comment">    /** Display Network Interface Info **/</span></div>
<div class="line"><span class="comment">    /*******************************/</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Interface Information</span></div>
<div class="line">    <span class="keyword">struct </span>ifaddrs *ifap, *ifa;</div>
<div class="line">    <span class="keywordtype">int</span> family, s, n;</div>
<div class="line">    <span class="keywordtype">char</span> host[NI_MAXHOST];</div>
<div class="line"> </div>
<div class="line">retryIF:</div>
<div class="line"> </div>
<div class="line">    getifaddrs(&amp;ifap);</div>
<div class="line">    <span class="keywordflow">for</span> (ifa = ifap, n = 0; ifa != NULL; ifa = ifa-&gt;ifa_next, n++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (tunStr.compare(ifa-&gt;ifa_name) != 0 || ifa-&gt;ifa_addr == NULL)</div>
<div class="line">        {</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (ifa-&gt;ifa_next == NULL)</div>
<div class="line">            {</div>
<div class="line">                drawCfg(0);</div>
<div class="line">                <span class="keywordflow">goto</span> retryIF;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        mvwprintw(win, 2, 0, <span class="stringliteral">&quot;%8s &quot;</span>, ifa-&gt;ifa_name);</div>
<div class="line"> </div>
<div class="line">        family = ifa-&gt;ifa_addr-&gt;sa_family;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//This is an IP interface, display the IP</span></div>
<div class="line">        <span class="keywordflow">if</span> (family == AF_INET || family == AF_INET6)</div>
<div class="line">        {</div>
<div class="line">            s = getnameinfo(ifa-&gt;ifa_addr, (family == AF_INET) ? <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in) : sizeof(struct sockaddr_in6), host, NI_MAXHOST, NULL, 0, NI_NUMERICHOST);</div>
<div class="line">            <span class="keywordflow">if</span> (s == 0)</div>
<div class="line">            {</div>
<div class="line">                wprintw(win, <span class="stringliteral">&quot;IP: %s\n&quot;</span>, host);</div>
<div class="line">                std::string str1 = host;</div>
<div class="line">                <span class="keywordtype">unsigned</span> found = str1.find_last_of(<span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line">                subIP = str1.substr(0, found);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    mvwhline(win, 15, 1, ACS_HLINE, maxY - 2);</div>
<div class="line"> </div>
<div class="line">    refresh();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/******************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> drawHelp()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    drawMain();</div>
<div class="line"> </div>
<div class="line">    attron(COLOR_PAIR(1));</div>
<div class="line">    mvwprintw(win, 4, 1, <span class="stringliteral">&quot;**RF24Gateway NCurses Help Menu**&quot;</span>);</div>
<div class="line">    wprintw(win, <span class="stringliteral">&quot; Controls:\n&quot;</span>);</div>
<div class="line">    wprintw(win, <span class="stringliteral">&quot; ARROW_UP/DOWN: Scroll up/down in supported menus\n&quot;</span>);</div>
<div class="line">    wprintw(win, <span class="stringliteral">&quot; ARROW_LEFT/RIGHT: Scroll between supported menus\n&quot;</span>);</div>
<div class="line">    wprintw(win, <span class="stringliteral">&quot; &#39;c&#39; key: Open IP configuration menu\n&quot;</span>);</div>
<div class="line">    wprintw(win, <span class="stringliteral">&quot; &#39;t&#39; key: Display topology of mesh\n&quot;</span>);</div>
<div class="line">    wprintw(win, <span class="stringliteral">&quot; &#39;w&#39; key: Increase frame-rate of display\n&quot;</span>);</div>
<div class="line">    wprintw(win, <span class="stringliteral">&quot; &#39;s&#39; key: Decrease frame-rate of display\n&quot;</span>);</div>
<div class="line">    wprintw(win, <span class="stringliteral">&quot; &#39;a&#39; key: Display active IP connections\n&quot;</span>);</div>
<div class="line">    wprintw(win, <span class="stringliteral">&quot; &#39;h&#39; key: Display this menu\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    timeout(30000);</div>
<div class="line">    getch();</div>
<div class="line">    timeout(0);</div>
<div class="line"> </div>
<div class="line">    drawMain();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/******************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> drawCfg(<span class="keywordtype">bool</span> isConf)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (isConf)</div>
<div class="line">    {</div>
<div class="line">        drawMain();</div>
<div class="line">    }</div>
<div class="line">    nocbreak();</div>
<div class="line">    echo();</div>
<div class="line">    timeout(30000);</div>
<div class="line"> </div>
<div class="line">    sleep(1);</div>
<div class="line">    wattron(win, COLOR_PAIR(1));</div>
<div class="line">    mvwprintw(win, 5, 1, isConf ? <span class="stringliteral">&quot;IP Configuration\n&quot;</span> : <span class="stringliteral">&quot;**Interface Not Configured:**\n&quot;</span>);</div>
<div class="line">    wattroff(win, COLOR_PAIR(1));</div>
<div class="line">    mvwprintw(win, 6, 1, <span class="stringliteral">&quot;Enter IP Address: \n&quot;</span>);</div>
<div class="line">    refresh();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> ip[20], mask[20];</div>
<div class="line">    mvgetstr(6, 19, ip);</div>
<div class="line"> </div>
<div class="line">    mvwprintw(win, 7, 1, <span class="stringliteral">&quot;Enter Subnet Mask: \n&quot;</span>);</div>
<div class="line">    refresh();</div>
<div class="line"> </div>
<div class="line">    mvgetstr(7, 20, mask);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (strlen(ip) &gt;= 6 &amp;&amp; strlen(mask) &gt;= 7)</div>
<div class="line">    {</div>
<div class="line">        gw.setIP(ip, mask);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        mvwprintw(win, 8, 1, <span class="stringliteral">&quot;Unable to set IP/Subnet \n&quot;</span>);</div>
<div class="line">        refresh();</div>
<div class="line">        sleep(3);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    timeout(0);</div>
<div class="line">    cbreak();</div>
<div class="line">    noecho();</div>
<div class="line"> </div>
<div class="line">    drawMain();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/******************************************************************/</span></div>
<div class="line"><span class="comment">/******************Curses Pad Functions****************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> drawDevPad()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    wclear(devPad);</div>
<div class="line"> </div>
<div class="line">    std::string line;</div>
<div class="line">    std::ifstream inFile;</div>
<div class="line">    inFile.open(<span class="stringliteral">&quot;/proc/net/dev&quot;</span>);</div>
<div class="line">    <span class="keywordflow">while</span> (inFile.good())</div>
<div class="line">    {</div>
<div class="line">        getline(inFile, line); <span class="comment">// get line from file</span></div>
<div class="line">        <span class="comment">// search</span></div>
<div class="line">        <span class="keywordflow">if</span> (line.find(tunStr) != std::string::npos)</div>
<div class="line">        {</div>
<div class="line"> </div>
<div class="line">            <span class="keywordtype">char</span> txBytes[20], txPackets[20], txErrs[20];</div>
<div class="line">            <span class="keywordtype">char</span> rxBytes[20], rxPackets[20], rxErrs[20];</div>
<div class="line">            <span class="keywordtype">char</span> dummy[20];</div>
<div class="line"> </div>
<div class="line">            whline(devPad, ACS_HLINE, 20);</div>
<div class="line">            mvwprintw(devPad, 0, 3, <span class="stringliteral">&quot; IF Stats: &quot;</span>);</div>
<div class="line"> </div>
<div class="line">            sscanf(line.c_str(), <span class="stringliteral">&quot;%s %s %s %s %s %s %s %s %s %s %s %s&quot;</span>, dummy, rxBytes, rxPackets, rxErrs, dummy, dummy, dummy, dummy, dummy, txBytes, txPackets, txErrs);</div>
<div class="line"> </div>
<div class="line">            mvwprintw(devPad, 1, 0, <span class="stringliteral">&quot;RX Bytes %s\nRX Packets %s\nRX Errs %s\nTX Bytes %s\nTX Packets %s\nTX Errs %s\n&quot;</span>, rxBytes, rxPackets, rxErrs, txBytes, txPackets, txErrs);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordtype">float</span> bytesRNow = strtof(rxBytes, NULL) - bRX;</div>
<div class="line">            <span class="keywordtype">float</span> bytesTNow = strtof(txBytes, NULL) - bTX;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordtype">float</span> RKBS = bytesRNow &gt; 0 ? bytesRNow / updateRate : 0.0;</div>
<div class="line">            <span class="keywordtype">float</span> TKBS = bytesRNow &gt; 0 ? bytesTNow / updateRate : 0.0;</div>
<div class="line"> </div>
<div class="line">            wprintw(devPad, <span class="stringliteral">&quot;\nRX %.03f KB/s\n&quot;</span>, RKBS);</div>
<div class="line">            wprintw(devPad, <span class="stringliteral">&quot;TX %.03f KB/s\n&quot;</span>, TKBS);</div>
<div class="line"> </div>
<div class="line">            bRX = strtol(rxBytes, NULL, 10);</div>
<div class="line">            bTX = strtol(txBytes, NULL, 10);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    inFile.close();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/******************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> drawMeshPad()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    wclear(meshPad);</div>
<div class="line"> </div>
<div class="line">    meshInfoTimer = millis();</div>
<div class="line">    <span class="comment">//uint8_t pos=5;</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; mesh.addrListTop; i++)</div>
<div class="line">    {</div>
<div class="line">        mvwprintw(meshPad, i + 1, 0, <span class="stringliteral">&quot; Address: 0%o ID: %d \n&quot;</span>, mesh.addrList[i].address, mesh.addrList[i].nodeID);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (padSelection == 0)</div>
<div class="line">    {</div>
<div class="line">        wattron(meshPad, COLOR_PAIR(1));</div>
<div class="line">        mvwhline(meshPad, meshScroll, 0, ACS_HLINE, maxY);</div>
<div class="line">        wattroff(meshPad, COLOR_PAIR(1));</div>
<div class="line">        mvwprintw(meshPad, meshScroll, 3, <span class="stringliteral">&quot; Mesh Info: &quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        wattroff(meshPad, COLOR_PAIR(1));</div>
<div class="line">        mvwhline(meshPad, meshScroll, 0, ACS_HLINE, maxY);</div>
<div class="line">        mvwprintw(meshPad, meshScroll, 3, <span class="stringliteral">&quot; Mesh Info: &quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/******************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> drawRF24Pad()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    wclear(rf24Pad);</div>
<div class="line">    mvwprintw(rf24Pad, 1, 0, <span class="stringliteral">&quot;Address: 0%o\n&quot;</span>, mesh.mesh_address);</div>
<div class="line">    wprintw(rf24Pad, <span class="stringliteral">&quot;nodeID: %d\n&quot;</span>, mesh.getNodeID());</div>
<div class="line">    wprintw(rf24Pad, <span class="stringliteral">&quot;En Mesh: %s\n&quot;</span>, gw.meshEnabled() ? <span class="stringliteral">&quot;True&quot;</span> : <span class="stringliteral">&quot;False&quot;</span>);</div>
<div class="line">    radio.maskIRQ(1, 1, 1);</div>
<div class="line">    <span class="keywordtype">int</span> dr = radio.getDataRate();</div>
<div class="line">    <span class="keywordtype">int</span> pa = radio.getPALevel();</div>
<div class="line">    radio.maskIRQ(1, 1, 0);</div>
<div class="line">    <span class="comment">// clang-format off</span></div>
<div class="line">    wprintw(rf24Pad, <span class="stringliteral">&quot;Data-Rate: %s\n&quot;</span>, dr == 0 ? <span class="stringliteral">&quot;1MBPS&quot;</span> : dr == 1 ? <span class="stringliteral">&quot;2MBPS&quot;</span></div>
<div class="line">                                                          : dr == 2 ? <span class="stringliteral">&quot;250KBPS&quot;</span></div>
<div class="line">                                                                    : <span class="stringliteral">&quot;ERROR&quot;</span>);</div>
<div class="line">    wprintw(rf24Pad, <span class="stringliteral">&quot;PA Level: %s\n&quot;</span>, pa == 0 ? <span class="stringliteral">&quot;MIN&quot;</span> : pa == 1 ? <span class="stringliteral">&quot;LOW&quot;</span></div>
<div class="line">                                                       : pa == 2 ? <span class="stringliteral">&quot;HIGH&quot;</span></div>
<div class="line">                                                       : pa == 3 ? <span class="stringliteral">&quot;MAX&quot;</span></div>
<div class="line">                                                                 : <span class="stringliteral">&quot;ERROR&quot;</span>);</div>
<div class="line">    <span class="comment">// clang-format on</span></div>
<div class="line">    wprintw(rf24Pad, <span class="stringliteral">&quot;IF Type: %s\n&quot;</span>, gw.config_TUN == 1 ? <span class="stringliteral">&quot;TUN&quot;</span> : <span class="stringliteral">&quot;TAP&quot;</span>);</div>
<div class="line">    wprintw(rf24Pad, <span class="stringliteral">&quot;IF Drops: %u\n&quot;</span>, gw.ifDropped());</div>
<div class="line"><span class="preprocessor">#if defined(ENABLE_NETWORK_STATS)</span></div>
<div class="line">    uint32_t ok, fail;</div>
<div class="line">    network.failures(&amp;fail, &amp;ok);</div>
<div class="line">    wprintw(rf24Pad, <span class="stringliteral">&quot;TX Packets(sys): %u\n&quot;</span>, ok);</div>
<div class="line">    wprintw(rf24Pad, <span class="stringliteral">&quot;TX Drops: %u\n&quot;</span>, fail);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    wprintw(rf24Pad, <span class="stringliteral">&quot;RX Packets(user): %u\n&quot;</span>, networkPacketsRX);</div>
<div class="line">    <span class="keywordflow">if</span> (gw.fifoCleared)</div>
<div class="line">    {</div>
<div class="line">        ++fifoClears;</div>
<div class="line">        gw.fifoCleared = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    wprintw(rf24Pad, <span class="stringliteral">&quot;Interrupt Errors: %u&quot;</span>, fifoClears);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (padSelection == 1)</div>
<div class="line">    {</div>
<div class="line">        wattron(rf24Pad, COLOR_PAIR(1));</div>
<div class="line">        mvwhline(rf24Pad, rf24Scroll, 0, ACS_HLINE, maxY);</div>
<div class="line">        wattroff(rf24Pad, COLOR_PAIR(1));</div>
<div class="line">        mvwprintw(rf24Pad, rf24Scroll, 3, <span class="stringliteral">&quot; RF24Network Info: &quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        wattroff(rf24Pad, COLOR_PAIR(1));</div>
<div class="line">        mvwhline(rf24Pad, rf24Scroll, 0, ACS_HLINE, maxY);</div>
<div class="line">        mvwprintw(rf24Pad, rf24Scroll, 3, <span class="stringliteral">&quot; RF24Network Info: &quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/******************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> drawConnPad()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (topo) {</div>
<div class="line">        drawTopology();</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    wattroff(connPad, COLOR_PAIR(2));</div>
<div class="line">    <span class="keywordtype">int</span> ctr = 0;</div>
<div class="line">    <span class="keywordtype">size_t</span> lCtr = 1;</div>
<div class="line">    std::string line;</div>
<div class="line">    wclear(connPad);</div>
<div class="line">    <span class="comment">//box(connPad,ACS_VLINE,ACS_HLINE);</span></div>
<div class="line"> </div>
<div class="line">    std::ifstream inFile;</div>
<div class="line">    inFile.open(<span class="stringliteral">&quot;/proc/net/nf_conntrack&quot;</span>);</div>
<div class="line">    <span class="keywordflow">while</span> (inFile.good())</div>
<div class="line">    {</div>
<div class="line">        getline(inFile, line); <span class="comment">// get line from file</span></div>
<div class="line">                               <span class="comment">// search</span></div>
<div class="line">        <span class="keywordflow">if</span> (line.find(subIP) != std::string::npos)</div>
<div class="line">        {</div>
<div class="line"> </div>
<div class="line">            std::string src = <span class="stringliteral">&quot;src&quot;</span>;</div>
<div class="line">            <span class="keywordtype">unsigned</span> fnd = line.find(src);</div>
<div class="line">            fnd = line.find_last_of(<span class="stringliteral">&quot;0123456789&quot;</span>, fnd - 2);</div>
<div class="line">            fnd = line.find_last_of(<span class="stringliteral">&quot; &quot;</span>, fnd - 2);</div>
<div class="line">            <span class="keywordtype">unsigned</span> findEnd = line.find(<span class="stringliteral">&quot; mark=&quot;</span>);</div>
<div class="line">            line = line.substr(fnd, findEnd - fnd);</div>
<div class="line">            mvwprintw(connPad, ctr++, 0, <span class="stringliteral">&quot;%d %s\n&quot;</span>, lCtr++, line.c_str());</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (ctr &gt; maxX - 15)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    inFile.close();</div>
<div class="line">    mvwhline(win, 15, 1, ACS_HLINE, maxY - 2);</div>
<div class="line">    mvwprintw(win, 15, 10, <span class="stringliteral">&quot;Active IP Connections:&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/******************************************************************/</span></div>
<div class="ttc" id="aclassESBGateway_html"><div class="ttname"><a href="classESBGateway.html">ESBGateway</a></div><div class="ttdef"><b>Definition</b> <a href="RF24Gateway_8h_source.html#l00065">RF24Gateway.h:66</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 11 2024 for RF24Gateway - TCP/IP over RF24Network by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
